receivers:
  # OTLP receiver for logs and traces from applications
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

  # Prometheus receiver to scrape metrics from services
  prometheus:
    config:
      scrape_configs:
        - job_name: 'web-api'
          scrape_interval: 15s
          static_configs:
            - targets: ['web-api:8000']
        - job_name: 'otel-collector'
          scrape_interval: 15s
          static_configs:
            - targets: ['localhost:8888']

processors:
  batch:
    timeout: 1s
    send_batch_size: 1024

  # Add resource attributes
  resource:
    attributes:
      - key: deployment.environment
        value: demo
        action: upsert

exporters:
  debug:
    verbosity: basic

  # File exporter for traces
  file/traces:
    path: /var/log/otel/traces.jsonl
    rotation:
      max_megabytes: 100
      max_days: 1
      max_backups: 3

  # File exporter for logs
  file/logs:
    path: /var/log/otel/logs.jsonl
    rotation:
      max_megabytes: 100
      max_days: 1
      max_backups: 3

  # File exporter for metrics
  file/metrics:
    path: /var/log/otel/metrics.jsonl
    rotation:
      max_megabytes: 100
      max_days: 1
      max_backups: 3

service:
  # Enable telemetry for the collector itself
  telemetry:
    metrics:
      address: 0.0.0.0:8888

  pipelines:
    # Traces pipeline: OTLP -> file
    traces:
      receivers: [otlp]
      processors: [batch, resource]
      exporters: [debug, file/traces]

    # Logs pipeline: OTLP -> file
    logs:
      receivers: [otlp]
      processors: [batch, resource]
      exporters: [debug, file/logs]

    # Metrics pipeline: Prometheus scraping -> file
    metrics:
      receivers: [prometheus]
      processors: [batch, resource]
      exporters: [debug, file/metrics]
